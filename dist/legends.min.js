/*!
 * Legends.js
 * Copyright (c) 2014 Tyler Johnson
 * MIT License
 */
!function(){function n(e,t){return e=Array.prototype.slice.call(e,0),null==t&&(t=[]),e.forEach(function(e){Array.isArray(e)?n(e,t):t.push(e)}),t}function e(n,e){return n.then(function(n){return e(null,n)},function(n){return e(n)})}function t(n){var e=[],t=n.length;return new f(function(r,o){return t?(n.forEach(function(n,u){n=f.lift(n),n.then(function(n){u in e||(e[u]=n,--t||r(e))},o)}),void 0):r(e)})}function r(n,r,o){var u,i,s,a=[];for(n.length>0&&"function"==typeof n[n.length-1]&&(u=n.pop());n.length;)i=n.splice(0,r),a.push(o(i));return s=t(a).then(function(n){return n.reduce(function(n,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n},{})}),u&&e(s,u),s}function o(n){switch(typeof n){case"string":return n;case"boolean":return n?"true":"false";case"number":return n.toString(10);default:return""}}function u(n,e,t){return null==n&&(n=void 0),null==e&&(e="&"),null==t&&(t="="),"object"==typeof n?Object.keys(n).map(function(r){var u=encodeURIComponent(o(r))+t,i=n[r];return Array.isArray(i)?i.map(function(n){return u+encodeURIComponent(o(n))}).join(e):u+encodeURIComponent(o(i))}).join(e):""}function i(n,e){if(null==n&&(n=new Error),n.name="HTTPError",null!=e){var t=e.status||e.statusCode;if(!n.message){var r=l[t];null==r&&(r="Server responded with status code "+t),n.message=r}n.status=t,n.response=e,n.toString=function(){return this.name+" "+this.status+": "+this.message}}return n}function s(n){var e=require("http");return new f(function(t,r){e.get(n,function(n){function e(e){r(i(e,n))}if(n.on("error",e),n.statusCode>=400)return e();var o="";n.on("data",function(n){o+=n.toString("utf-8")}),n.on("end",function(){try{t(JSON.parse(o))}catch(n){e(n)}})}).on("error",function(n){r(i(n))})})}function a(n){var e=new XMLHttpRequest;return new f(function(t,r){function o(n){r(i(n,e))}e.onload=function(){if(e.status>=400)return o();try{t(JSON.parse(e.responseText))}catch(n){o(n)}},e.open("get",n),e.send()})}function c(n){return"function"==typeof require?s(n):a(n)}function m(n,e){return this instanceof m?(this.key=n,this.region=e,void 0):new m(n,e)}var f=function(n,e){function t(n,e){return(typeof e)[0]==n}function r(i,s){return s=function a(c,m,f,l,h){function p(n){return function(e){h&&(h=0,a(t,n,e))}}if(l=a.q,c!=t)return r(function(n,e){l.push({p:this,r:n,j:e,1:c,0:m})});if(f&&t(n,f)|t(e,f))try{h=f.then}catch(d){m=0,f=d}if(t(n,h))try{h.call(f,p(1),m=p(0))}catch(d){m(d)}else for(s=o(i,f,m),i=0;i<l.length;)h=l[i++],t(n,c=h[m])?u(h.p,h.r,h.j,f,c):(m?h.r:h.j)(f)},s.q=[],i.call(i={then:function(n,e){return s(n,e)}},function(n){s(t,1,n)},function(n){s(t,0,n)}),i}function o(e,o,i){return function(s,a){return t(n,s=i?s:a)?r(function(n,e){u(this,n,e,o,s)}):e}}function u(r,o,u,i,s){setTimeout(function(){try{i=s(i),s=i&&t(e,i)|t(n,i)&&i.then,t(n,s)?i==r?u(new TypeError):s.call(i,o,u):o(i)}catch(a){u(a)}},0)}return r.resolve=function(n,e){return(e={}).then=o(e,n,1),e},r.reject=function(n,e){return(e={}).then=o(e,n,0),e},r.lift=function(n){return new r(function(e,t){"object"==typeof n&&Object.prototype.hasOwnProperty.call(n,"then")?n.then(e,t):n instanceof Error?t(n):e(n)})},r}("f","o"),l={400:"Bad request",401:"Unauthorized",404:"Not found",500:"Internal server error",503:"Service Unavailable"},h=m.prototype;m.request=function(n,t){"object"!=typeof n&&(n={});var r=null!=n.method?n.method:"",o=null!=n.region?n.region:"na",i=null!=n.version?n.version:"1.1",s=n.key,a="object"==typeof n.params?n.params:{},m=n.extract,f="http://prod.api.pvp.net/api/lol/";f+=o.toLowerCase()+"/","v"!=i[0]&&(i="v"+i),f+=i+"/",f+=r.split("/").map(function(n){return encodeURIComponent(n)}).reduce(function(n,e){return""!=e&&n.push(e),n},[]).join("/"),null!=s&&(a.api_key=s),f+="?"+u(a);var l=c(f);return null!=m&&(l=l.then(function(n){return n[m]})),"function"==typeof t&&e(l,t),l},h.request=function(n,e){return"object"!=typeof n&&(n={}),null==n.key&&(n.key=this.key),null==n.region&&(n.region=this.region),m.request(n,e)},m.MATCH_MAKING_QUEUES={2:"Normal 5v5 Blind Pick",4:"Ranked Solo 5v5",7:"Coop vs AI 5v5",8:"Normal 3v3",14:"Normal 5v5 Draft Pick",16:"Dominion 5v5 Blind Pick",17:"Dominion 5v5 Draft Pick",25:"Dominion Coop vs AI",41:"Ranked Team 3v3",42:"Ranked Team 5v5",52:"Twisted Treeline Coop vs AI",65:"ARAM",67:"ARAM Coop vs AI",70:"One for All 5v5",72:"Snowdown Showdown 1v1",73:"Snowdown Showdown 2v2"},m.MAP_NAMES={1:{name:"Summoner's Rift",notes:"Summer Variant"},2:{name:"Summoner's Rift",notes:"Autumn Variant"},3:{name:"The Proving Grounds",notes:"Tutorial Map"},4:{name:"Twisted Treeline",notes:"Original Version"},8:{name:"The Crystal Scar",notes:"Dominion Map"},10:{name:"Twisted Treeline",notes:"Current Version"},12:{name:"Howling Abyss",notes:"ARAM Map"}},m.REGIONS=["NA","EUW","EUNE","BR","TR","LAS"],m.CHALLENGER_TYPES=["RANKED_SOLO_5X5","RANKED_TEAM_3X3","RANKED_TEAM_5X5"],h.champions=h.getChampions=function(n,e){return"function"==typeof n&&null==e&&(e=n,n=!1),this.request({method:"champion",version:"1.1",params:{freeToPlay:n?!0:!1},extract:"champions"},e)},h.recentGames=h.getRecentGames=function(n,e){return this.request({method:"game/by-summoner/"+n+"/recent",version:"1.3",extract:"games"},e)},h.challengerLeagues=h.getChallengerLeagues=function(n,e){return"function"==typeof n&&(e=n,n=0),"number"==typeof n&&(n=m.CHALLENGER_TYPES[n]),this.request({method:"league/challenger",version:"2.3",params:{type:n}},e)},h.leagueEntries=h.getLeagueEntries=function(n,e){return this.request({method:"league/by-summoner/"+n+"/entry",version:"2.3"},e)},h.leagues=h.getLeagues=function(n,e){return this.request({method:"league/by-summoner/"+n,version:"2.3"},e)},h.summaryStats=h.getSummaryStats=function(n,e,t){return"function"==typeof e&&null==t&&(t=e,e=null),null!=e&&(e="SEASON"+e),this.request({method:"stats/by-summoner/"+n+"/summary",version:"1.2",params:{season:e},extract:"playerStatSummaries"},t)},h.rankedStats=h.getRankedStats=function(n,e,t){return"function"==typeof e&&null==t&&(t=e,e=null),null!=e&&(e="SEASON"+e),this.request({method:"stats/by-summoner/"+n+"/ranked",version:"1.2",params:{season:e},extract:"champions"},t)},h.summonerById=h.summonersById=h.getSummonerById=h.getSummonersById=function(){var e=n(arguments),t=this;return r(e,40,function(n){return t.request({method:"summoner/"+n.join(","),version:"1.3"})})},h.summonerByName=h.summonersByName=h.getSummonerByName=h.getSummonersByName=function(){var e=n(arguments),t=this;return r(e,40,function(n){return t.request({method:"summoner/by-name/"+n.join(","),version:"1.3"})})},h.runes=h.getRunes=function(){var e=n(arguments),t=this;return r(e,40,function(n){return t.request({method:"summoner/"+n.join(",")+"/runes",version:"1.3"})})},h.masteries=h.getMasteries=function(){var e=n(arguments),t=this;return r(e,40,function(n){return t.request({method:"summoner/"+n.join(",")+"/masteries",version:"1.3"})})},h.names=h.summonerNames=h.getNames=h.getSummonerNames=function(){var e=n(arguments),t=this;return r(e,40,function(n){return t.request({method:"summoner/"+n.join(",")+"/name",version:"1.3"})})},h.teams=h.getTeams=function(n,e){return this.request({method:"team/by-summoner/"+n,version:"2.2"},e)},"object"==typeof module&&null!=module.exports?module.exports=m:"undefined"!=typeof window&&(window.Legends=m)}();