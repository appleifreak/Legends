/*!
 * Legends.js
 * Copyright (c) 2014 Tyler Johnson
 * MIT License
 */
!function(){function e(n,t){return n=Array.prototype.slice.call(n,0),null==t&&(t=[]),n.forEach(function(n){Array.isArray(n)?e(n,t):t.push(n)}),t}function n(e,n){return e.then(function(e){return n(null,e)},function(e){return n(e)})}function t(e){var n=[],t=e.length;return new l(function(r,o){return t?(e.forEach(function(e,u){e=l.lift(e),e.then(function(e){u in n||(n[u]=e,--t||r(n))},o)}),void 0):r(n)})}function r(e,r,o){var u,i,s,a=[];for(e.length>0&&"function"==typeof e[e.length-1]&&(u=e.pop());e.length;)i=e.splice(0,r),a.push(o(i));return s=t(a).then(function(e){return e.reduce(function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},{})}),u&&n(s,u),s}function o(e){return e[0].toUpperCase()+e.substr(1)}function u(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return e.toString(10);default:return""}}function i(e,n,t){return null==e&&(e=void 0),null==n&&(n="&"),null==t&&(t="="),"object"==typeof e?Object.keys(e).map(function(r){var o=encodeURIComponent(u(r))+t,i=e[r];return Array.isArray(i)?i.map(function(e){return o+encodeURIComponent(u(e))}).join(n):o+encodeURIComponent(u(i))}).join(n):""}function s(e,n){if(null==e&&(e=new Error),e.name="HTTPError",null!=n){var t=n.status||n.statusCode;if(!e.message){var r=h[t];null==r&&(r="Server responded with status code "+t),e.message=r}e.status=t,e.response=n,e.toString=function(){return this.name+" "+this.status+": "+this.message}}return e}function a(e){var n=require("http");return new l(function(t,r){n.get(e,function(e){function n(n){r(s(n,e))}if(e.on("error",n),e.statusCode>=400)return n();var o="";e.on("data",function(e){o+=e.toString("utf-8")}),e.on("end",function(){try{t(JSON.parse(o))}catch(e){n(e)}})}).on("error",function(e){r(s(e))})})}function c(e){var n=new XMLHttpRequest;return new l(function(t,r){function o(e){r(s(e,n))}n.onload=function(){if(n.status>=400)return o();try{t(JSON.parse(n.responseText))}catch(e){o(e)}},n.open("get",e),n.send()})}function m(e){return"function"==typeof require?a(e):c(e)}function f(e,n){return this instanceof f?(this.key=e,this.region=n,this["static"]=new f.Static(e,n),void 0):new f(e,n)}var l=function(e,n){function t(e,n){return(typeof n)[0]==e}function r(i,s){return s=function a(c,m,f,l,h){function p(e){return function(n){h&&(h=0,a(t,e,n))}}if(l=a.q,c!=t)return r(function(e,n){l.push({p:this,r:e,j:n,1:c,0:m})});if(f&&t(e,f)|t(n,f))try{h=f.then}catch(d){m=0,f=d}if(t(e,h))try{h.call(f,p(1),m=p(0))}catch(d){m(d)}else for(s=o(i,f,m),i=0;i<l.length;)h=l[i++],t(e,c=h[m])?u(h.p,h.r,h.j,f,c):(m?h.r:h.j)(f)},s.q=[],i.call(i={then:function(e,n){return s(e,n)}},function(e){s(t,1,e)},function(e){s(t,0,e)}),i}function o(n,o,i){return function(s,a){return t(e,s=i?s:a)?r(function(e,n){u(this,e,n,o,s)}):n}}function u(r,o,u,i,s){setTimeout(function(){try{i=s(i),s=i&&t(n,i)|t(e,i)&&i.then,t(e,s)?i==r?u(new TypeError):s.call(i,o,u):o(i)}catch(a){u(a)}},0)}return r.resolve=function(e,n){return(n={}).then=o(n,e,1),n},r.reject=function(e,n){return(n={}).then=o(n,e,0),n},r.lift=function(e){return new r(function(n,t){"object"==typeof e&&"function"==typeof e.then?e.then(n,t):e instanceof Error?t(e):n(e)})},r}("f","o"),h={400:"Bad request",401:"Unauthorized",404:"Not found",500:"Internal server error",503:"Service Unavailable"},p=f.prototype;f.request=function(e,t){"object"!=typeof e&&(e={});var r=null!=e.method?e.method:"",o=null!=e.region?e.region:"na",u=null!=e.version?e.version:"1.1",s=e.key,a="object"==typeof e.params?e.params:{},c=e.extract,f="http://prod.api.pvp.net/api/lol/";f+=o.toLowerCase()+"/","v"!=u[0]&&(u="v"+u),f+=u+"/",f+=r.split("/").map(function(e){return encodeURIComponent(e)}).reduce(function(e,n){return""!=n&&e.push(n),e},[]).join("/"),null!=s&&(a.api_key=s),f+="?"+i(a);var l=m(f);return null!=c&&(l=l.then(function(e){return e[c]})),"function"==typeof t&&n(l,t),l},p.request=function(e,n){return"object"!=typeof e&&(e={}),null==e.key&&(e.key=this.key),null==e.region&&(e.region=this.region),f.request(e,n)},f.MATCH_MAKING_QUEUES={2:"Normal 5v5 Blind Pick",4:"Ranked Solo 5v5",7:"Coop vs AI 5v5",8:"Normal 3v3",14:"Normal 5v5 Draft Pick",16:"Dominion 5v5 Blind Pick",17:"Dominion 5v5 Draft Pick",25:"Dominion Coop vs AI",41:"Ranked Team 3v3",42:"Ranked Team 5v5",52:"Twisted Treeline Coop vs AI",65:"ARAM",67:"ARAM Coop vs AI",70:"One for All 5v5",72:"Snowdown Showdown 1v1",73:"Snowdown Showdown 2v2"},f.MAP_NAMES={1:{name:"Summoner's Rift",notes:"Summer Variant"},2:{name:"Summoner's Rift",notes:"Autumn Variant"},3:{name:"The Proving Grounds",notes:"Tutorial Map"},4:{name:"Twisted Treeline",notes:"Original Version"},8:{name:"The Crystal Scar",notes:"Dominion Map"},10:{name:"Twisted Treeline",notes:"Current Version"},12:{name:"Howling Abyss",notes:"ARAM Map"}},f.REGIONS=["NA","EUW","EUNE","BR","TR","LAS"],f.CHALLENGER_TYPES=["RANKED_SOLO_5X5","RANKED_TEAM_3X3","RANKED_TEAM_5X5"],p.champions=p.getChampions=function(e,n){return"function"==typeof e&&null==n&&(n=e,e=!1),this.request({method:"champion",version:"1.1",params:{freeToPlay:e?!0:!1},extract:"champions"},n)},p.recentGames=p.getRecentGames=function(e,n){return this.request({method:"game/by-summoner/"+e+"/recent",version:"1.3",extract:"games"},n)},p.challengerLeagues=p.getChallengerLeagues=function(e,n){return"function"==typeof e&&(n=e,e=0),"number"==typeof e&&(e=f.CHALLENGER_TYPES[e]),this.request({method:"league/challenger",version:"2.3",params:{type:e}},n)},p.leagueEntries=p.getLeagueEntries=function(e,n){return this.request({method:"league/by-summoner/"+e+"/entry",version:"2.3"},n)},p.leagues=p.getLeagues=function(e,n){return this.request({method:"league/by-summoner/"+e,version:"2.3"},n)},p.summaryStats=p.getSummaryStats=function(e,n,t){return"function"==typeof n&&null==t&&(t=n,n=null),null!=n&&(n="SEASON"+n),this.request({method:"stats/by-summoner/"+e+"/summary",version:"1.2",params:{season:n},extract:"playerStatSummaries"},t)},p.rankedStats=p.getRankedStats=function(e,n,t){return"function"==typeof n&&null==t&&(t=n,n=null),null!=n&&(n="SEASON"+n),this.request({method:"stats/by-summoner/"+e+"/ranked",version:"1.2",params:{season:n},extract:"champions"},t)},p.summonerById=p.summonersById=p.getSummonerById=p.getSummonersById=function(){var n=e(arguments),t=this;return r(n,40,function(e){return t.request({method:"summoner/"+e.join(","),version:"1.3"})})},p.summonerByName=p.summonersByName=p.getSummonerByName=p.getSummonersByName=function(){var n=e(arguments),t=this;return r(n,40,function(e){return t.request({method:"summoner/by-name/"+e.join(","),version:"1.3"})})},p.runes=p.getRunes=function(){var n=e(arguments),t=this;return r(n,40,function(e){return t.request({method:"summoner/"+e.join(",")+"/runes",version:"1.3"})})},p.masteries=p.getMasteries=function(){var n=e(arguments),t=this;return r(n,40,function(e){return t.request({method:"summoner/"+e.join(",")+"/masteries",version:"1.3"})})},p.names=p.summonerNames=p.getNames=p.getSummonerNames=function(){var n=e(arguments),t=this;return r(n,40,function(e){return t.request({method:"summoner/"+e.join(",")+"/name",version:"1.3"})})},p.teams=p.getTeams=function(e,n){return this.request({method:"team/by-summoner/"+e,version:"2.2"},n)},f.Static=function(e,n){return this instanceof f.Static?(this.key=e,this.region=n,void 0):new f.Static(e,n)};var d=f.Static.prototype;f.Static.request=function(e,n){return null==e&&(e={}),null==e.region&&(e.region="na"),null==e.version&&(e.version="1"),e.region="static-data/"+e.region,null!=e.id&&(e.method+="/"+e.id),f.request(e,n)},d.request=function(e,n){return"object"!=typeof e&&(e={}),null==e.key&&(e.key=this.key),null==e.region&&(e.region=this.region),f.Static.request(e,n)},f.Static.REGIONS=["NA","EUW","EUNE","BR","TR","LAS","KR","LAN","OCE","RU"];var y={champion:["champion","champions"],item:["item","items"],mastery:["mastery","masteries"],rune:["rune","runes"],"summoner-spell":["summonerSpell","summonerSpells"]};for(var g in y){var v=y[g];d[v[0]]=d[v[1]]=d["get"+o(v[0])]=d["get"+o(v[1])]=function(e,n){return"function"==typeof e&&null==n&&(n=e,e=null),this.request({method:g,id:e,extract:null!=e?null:"data"},n)}}d.realm=d.getRealm=function(e){return this.request({method:"realm"},e)},"object"==typeof module&&null!=module.exports?module.exports=f:"undefined"!=typeof window&&(window.Legends=f)}();