/*!
 * Legends.js
 * Copyright (c) 2014 Tyler Johnson
 * MIT License
 */
!function(){function e(n,t){return n=Array.prototype.slice.call(n,0),null==t&&(t=[]),n.forEach(function(n){Array.isArray(n)?e(n,t):t.push(n)}),t}function n(e,n){return e.then(function(e){return n(null,e)},function(e){return n(e)})}function t(e){var n=[],t=e.length;return new f(function(r,o){return t?(e.forEach(function(e,u){e=f.lift(e),e.then(function(e){u in n||(n[u]=e,--t||r(n))},o)}),void 0):r(n)})}function r(e,r,o){var u,i,s,a=[];for(e.length>0&&"function"==typeof e[e.length-1]&&(u=e.pop());e.length;)i=e.splice(0,r),a.push(o(i));return s=t(a).then(function(e){return e.reduce(function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},{})}),u&&n(s,u),s}function o(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return e.toString(10);default:return""}}function u(e,n,t){return null==e&&(e=void 0),null==n&&(n="&"),null==t&&(t="="),"object"==typeof e?Object.keys(e).map(function(r){var u=encodeURIComponent(o(r))+t,i=e[r];return Array.isArray(i)?i.map(function(e){return u+encodeURIComponent(o(e))}).join(n):u+encodeURIComponent(o(i))}).join(n):""}function i(e,n){if(null==e&&(e=new Error),e.name="HTTPError",null!=n){var t=n.status||n.statusCode;if(!e.message){var r=l[t];null==r&&(r="Server responded with status code "+t),e.message=r}e.status=t,e.response=n,e.toString=function(){return this.name+" "+this.status+": "+this.message}}return e}function s(e){var n=require("http");return new f(function(t,r){n.get(e,function(e){function n(n){r(i(n,e))}if(e.on("error",n),e.statusCode>=400)return n();var o="";e.on("data",function(e){o+=e.toString("utf-8")}),e.on("end",function(){try{t(JSON.parse(o))}catch(e){n(e)}})}).on("error",function(e){r(i(e))})})}function a(e){var n=new XMLHttpRequest;return new f(function(t,r){function o(e){r(i(e,n))}n.onload=function(){if(n.status>=400)return o();try{t(JSON.parse(n.responseText))}catch(e){o(e)}},n.open("get",e),n.send()})}function c(e){return"function"==typeof require?s(e):a(e)}function m(e,n){return this instanceof m?(this.key=e,this.region=n,this["static"]=new m.Static(e,n),void 0):new m(e,n)}var f=function(e,n){function t(e,n){return(typeof n)[0]==e}function r(i,s){return s=function a(c,m,f,l,h){function p(e){return function(n){h&&(h=0,a(t,e,n))}}if(l=a.q,c!=t)return r(function(e,n){l.push({p:this,r:e,j:n,1:c,0:m})});if(f&&t(e,f)|t(n,f))try{h=f.then}catch(d){m=0,f=d}if(t(e,h))try{h.call(f,p(1),m=p(0))}catch(d){m(d)}else for(s=o(i,f,m),i=0;i<l.length;)h=l[i++],t(e,c=h[m])?u(h.p,h.r,h.j,f,c):(m?h.r:h.j)(f)},s.q=[],i.call(i={then:function(e,n){return s(e,n)}},function(e){s(t,1,e)},function(e){s(t,0,e)}),i}function o(n,o,i){return function(s,a){return t(e,s=i?s:a)?r(function(e,n){u(this,e,n,o,s)}):n}}function u(r,o,u,i,s){setTimeout(function(){try{i=s(i),s=i&&t(n,i)|t(e,i)&&i.then,t(e,s)?i==r?u(new TypeError):s.call(i,o,u):o(i)}catch(a){u(a)}},0)}return r.resolve=function(e,n){return(n={}).then=o(n,e,1),n},r.reject=function(e,n){return(n={}).then=o(n,e,0),n},r.lift=function(e){return new r(function(n,t){"object"==typeof e&&"function"==typeof e.then?e.then(n,t):e instanceof Error?t(e):n(e)})},r}("f","o"),l={400:"Bad request",401:"Unauthorized",404:"Not found",500:"Internal server error",503:"Service Unavailable"},h=m.prototype;m.request=function(e,t){"object"!=typeof e&&(e={});var r=null!=e.method?e.method:"",o=null!=e.region?e.region:"na",i=null!=e.version?e.version:"1.1",s=e.key,a="object"==typeof e.params?e.params:{},m=e.extract,f="http://prod.api.pvp.net/api/lol/";f+=o.toLowerCase()+"/","v"!=i[0]&&(i="v"+i),f+=i+"/",f+=r.split("/").map(function(e){return encodeURIComponent(e)}).reduce(function(e,n){return""!=n&&e.push(n),e},[]).join("/"),null!=s&&(a.api_key=s),f+="?"+u(a);var l=c(f);return null!=m&&(l=l.then(function(e){return e[m]})),"function"==typeof t&&n(l,t),l},h.request=function(e,n){return"object"!=typeof e&&(e={}),null==e.key&&(e.key=this.key),null==e.region&&(e.region=this.region),m.request(e,n)},m.MATCH_MAKING_QUEUES={2:"Normal 5v5 Blind Pick",4:"Ranked Solo 5v5",7:"Coop vs AI 5v5",8:"Normal 3v3",14:"Normal 5v5 Draft Pick",16:"Dominion 5v5 Blind Pick",17:"Dominion 5v5 Draft Pick",25:"Dominion Coop vs AI",41:"Ranked Team 3v3",42:"Ranked Team 5v5",52:"Twisted Treeline Coop vs AI",65:"ARAM",67:"ARAM Coop vs AI",70:"One for All 5v5",72:"Snowdown Showdown 1v1",73:"Snowdown Showdown 2v2"},m.MAP_NAMES={1:{name:"Summoner's Rift",notes:"Summer Variant"},2:{name:"Summoner's Rift",notes:"Autumn Variant"},3:{name:"The Proving Grounds",notes:"Tutorial Map"},4:{name:"Twisted Treeline",notes:"Original Version"},8:{name:"The Crystal Scar",notes:"Dominion Map"},10:{name:"Twisted Treeline",notes:"Current Version"},12:{name:"Howling Abyss",notes:"ARAM Map"}},m.REGIONS=["NA","EUW","EUNE","BR","TR","LAS"],m.CHALLENGER_TYPES=["RANKED_SOLO_5X5","RANKED_TEAM_3X3","RANKED_TEAM_5X5"],h.champions=h.getChampions=function(e,n){return"function"==typeof e&&null==n&&(n=e,e=!1),this.request({method:"champion",version:"1.1",params:{freeToPlay:e?!0:!1},extract:"champions"},n)},h.recentGames=h.getRecentGames=function(e,n){return this.request({method:"game/by-summoner/"+e+"/recent",version:"1.3",extract:"games"},n)},h.challengerLeagues=h.getChallengerLeagues=function(e,n){return"function"==typeof e&&(n=e,e=0),"number"==typeof e&&(e=m.CHALLENGER_TYPES[e]),this.request({method:"league/challenger",version:"2.3",params:{type:e}},n)},h.leagueEntries=h.getLeagueEntries=function(e,n){return this.request({method:"league/by-summoner/"+e+"/entry",version:"2.3"},n)},h.leagues=h.getLeagues=function(e,n){return this.request({method:"league/by-summoner/"+e,version:"2.3"},n)},h.summaryStats=h.getSummaryStats=function(e,n,t){return"function"==typeof n&&null==t&&(t=n,n=null),null!=n&&(n="SEASON"+n),this.request({method:"stats/by-summoner/"+e+"/summary",version:"1.2",params:{season:n},extract:"playerStatSummaries"},t)},h.rankedStats=h.getRankedStats=function(e,n,t){return"function"==typeof n&&null==t&&(t=n,n=null),null!=n&&(n="SEASON"+n),this.request({method:"stats/by-summoner/"+e+"/ranked",version:"1.2",params:{season:n},extract:"champions"},t)},h.summonerById=h.summonersById=h.getSummonerById=h.getSummonersById=function(){var n=e(arguments),t=this;return r(n,40,function(e){return t.request({method:"summoner/"+e.join(","),version:"1.3"})})},h.summonerByName=h.summonersByName=h.getSummonerByName=h.getSummonersByName=function(){var n=e(arguments),t=this;return r(n,40,function(e){return t.request({method:"summoner/by-name/"+e.join(","),version:"1.3"})})},h.runes=h.getRunes=function(){var n=e(arguments),t=this;return r(n,40,function(e){return t.request({method:"summoner/"+e.join(",")+"/runes",version:"1.3"})})},h.masteries=h.getMasteries=function(){var n=e(arguments),t=this;return r(n,40,function(e){return t.request({method:"summoner/"+e.join(",")+"/masteries",version:"1.3"})})},h.names=h.summonerNames=h.getNames=h.getSummonerNames=function(){var n=e(arguments),t=this;return r(n,40,function(e){return t.request({method:"summoner/"+e.join(",")+"/name",version:"1.3"})})},h.teams=h.getTeams=function(e,n){return this.request({method:"team/by-summoner/"+e,version:"2.2"},n)},m.Static=function(e,n){return this instanceof m.Static?(this.key=e,this.region=n,void 0):new m.Static(e,n)};var p=m.Static.prototype;m.Static.request=function(e,n){return null==e&&(e={}),null==e.region&&(e.region="na"),null==e.version&&(e.version="1"),e.region="static-data/"+e.region,null!=e.id&&(e.method+="/"+e.id),m.request(e,n)},p.request=function(e,n){return"object"!=typeof e&&(e={}),null==e.key&&(e.key=this.key),null==e.region&&(e.region=this.region),m.Static.request(e,n)},m.Static.REGIONS=["NA","EUW","EUNE","BR","TR","LAS","KR","LAN","OCE","RU"];var d=["champion","item","mastery","rune","summoner-spell"];d.forEach(function(e){var n=e.replace(/-([a-z0-9])/gi,function(e,n){return n.toUpperCase()}),t="y"===n.substr(-1)?n.substr(0,n.length-1)+"ies":n+"s",r=n[0].toUpperCase()+n.substr(1),o=t[0].toUpperCase()+t.substr(1);p[n]=p[t]=p["get"+r]=p["get"+o]=function(n,t){return"function"==typeof n&&null==t&&(t=n,n=null),this.request({method:e,id:n,extract:null!=n?null:"data"},t)}}),p.realm=p.getRealm=function(e){return this.request({method:"realm"},e)},"object"==typeof module&&null!=module.exports?module.exports=m:"undefined"!=typeof window&&(window.Legends=m)}();