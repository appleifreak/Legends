/*!
 * Legends.js
 * Copyright (c) 2014 Tyler Johnson
 * MIT License
 */
!function(){function n(e,t){return e=Array.prototype.slice.call(e,0),null==t&&(t=[]),e.forEach(function(e){Array.isArray(e)?n(e,t):t.push(e)}),t}function e(n,e){return n.then(function(n){return e(null,n)},function(n){return e(n)})}function t(n){var e=[],t=n.length;return new f(function(o,r){return t?(n.forEach(function(n,u){n=avow.lift(n),n.then(function(n){u in e||(e[u]=n,--t||o(e))},r)}),void 0):o(e)})}function o(n){return"string"==typeof n?n:"boolean"==typeof n?n?"true":"false":""}function r(n,e,t){return null==n&&(n=void 0),null==e&&(e="&"),null==t&&(t="="),"object"==typeof n?Object.keys(n).map(function(r){var u=encodeURIComponent(o(r))+t,i=n[r];return Array.isArray(i)?i.map(function(n){return u+encodeURIComponent(o(n))}).join(e):u+encodeURIComponent(o(i))}).join(e):""}function u(n,e){if(null==n&&(n=new Error),n.name="HTTPError",null!=e){var t=e.status||e.statusCode;if(!n.message){var o=m[t];null==o&&(o="Server responded with status code "+t),n.message=o}n.status=t,n.response=e,n.toString=function(){return this.name+" "+this.status+": "+this.message}}return n}function i(n){var e=require("http");return new f(function(t,o){e.get(n,function(n){function e(e){o(u(e,n))}if(n.on("error",e),n.statusCode>=400)return e();var r="";n.on("data",function(n){r+=n.toString("utf-8")}),n.on("end",function(){try{t(JSON.parse(r))}catch(n){e(n)}})}).on("error",function(n){o(u(n))})})}function s(n){var e=new XMLHttpRequest;return new f(function(t,o){function r(n){o(u(n,e))}e.onload=function(){if(e.status>=400)return r();try{t(JSON.parse(e.responseText))}catch(n){r(n)}},e.open("get",n),e.send()})}function a(n){return"function"==typeof require?i(n):s(n)}function c(n,e){return this instanceof c?(this.key=n,this.region=e,void 0):new c(n,e)}var f=function(n,e){function t(n,e){return(typeof e)[0]==n}function o(i,s){return s=function a(c,f,m,p,l){function h(n){return function(e){l&&(l=0,a(t,n,e))}}if(p=a.q,c!=t)return o(function(n,e){p.push({p:this,r:n,j:e,1:c,0:f})});if(m&&t(n,m)|t(e,m))try{l=m.then}catch(y){f=0,m=y}if(t(n,l))try{l.call(m,h(1),f=h(0))}catch(y){f(y)}else for(s=r(i,m,f),i=0;i<p.length;)l=p[i++],t(n,c=l[f])?u(l.p,l.r,l.j,m,c):(f?l.r:l.j)(m)},s.q=[],i.call(i={then:function(n,e){return s(n,e)}},function(n){s(t,1,n)},function(n){s(t,0,n)}),i}function r(e,r,i){return function(s,a){return t(n,s=i?s:a)?o(function(n,e){u(this,n,e,r,s)}):e}}function u(o,r,u,i,s){setTimeout(function(){try{i=s(i),s=i&&t(e,i)|t(n,i)&&i.then,t(n,s)?i==o?u(new TypeError):s.call(i,r,u):r(i)}catch(a){u(a)}},0)}return o.resolve=function(n,e){return(e={}).then=r(e,n,1),e},o.reject=function(n,e){return(e={}).then=r(e,n,0),e},o}("f","o"),m={400:"Bad request",401:"Unauthorized",404:"Not found",500:"Internal server error"};c.request=function(n,t){"object"!=typeof n&&(n={});var o=null!=n.method?n.method:"",u=null!=n.region?n.region:"na",i=null!=n.version?n.version:"1.1",s=n.key,c="object"==typeof n.params?n.params:{},f=n.extract,m="http://prod.api.pvp.net/api/lol/";m+=u.toLowerCase()+"/","v"!=i[0]&&(i="v"+i),m+=i+"/",m+=o.split("/").map(function(n){return encodeURIComponent(n)}).reduce(function(n,e){return""!=e&&n.push(e),n},[]).join("/"),null!=s&&(c.api_key=s),m+="?"+r(c);var p=a(m);return null!=f&&(p=p.then(function(n){return n[f]})),"function"==typeof t&&e(p,t),p},c.prototype.request=function(n,e){return"object"!=typeof n&&(n={}),null==n.key&&(n.key=this.key),null==n.region&&(n.region=this.region),c.request(n,e)},c.MATCH_MAKING_QUEUES={2:"Normal 5v5 Blind Pick",4:"Ranked Solo 5v5",7:"Coop vs AI 5v5",8:"Normal 3v3",14:"Normal 5v5 Draft Pick",16:"Dominion 5v5 Blind Pick",17:"Dominion 5v5 Draft Pick",25:"Dominion Coop vs AI",41:"Ranked Team 3v3",42:"Ranked Team 5v5",52:"Twisted Treeline Coop vs AI",65:"ARAM",67:"ARAM Coop vs AI",70:"One for All 5v5",72:"Snowdown Showdown 1v1",73:"Snowdown Showdown 2v2"},c.MAP_NAMES={1:{name:"Summoner's Rift",notes:"Summer Variant"},2:{name:"Summoner's Rift",notes:"Autumn Variant"},3:{name:"The Proving Grounds",notes:"Tutorial Map"},4:{name:"Twisted Treeline",notes:"Original Version"},8:{name:"The Crystal Scar",notes:"Dominion Map"},10:{name:"Twisted Treeline",notes:"Current Version"},12:{name:"Howling Abyss",notes:"ARAM Map"}},c.REGIONS=["NA","EUW","EUNE","BR","TR"],c.prototype.getChampions=function(n,e){return"function"==typeof n&&null==e&&(e=n,n=!1),this.request({method:"champion",version:"1.1",params:{freeToPlay:n?!0:!1},extract:"champions"},e)},c.prototype.getRecentGames=function(n,e){return this.request({method:"game/by-summoner/"+n+"/recent",version:"1.2",extract:"games"},e)},c.prototype.getLeagues=function(n,e){return this.request({method:"league/by-summoner/"+n,version:"2.2"},e)},c.prototype.getSummaryStats=function(n,e,t){return"function"==typeof e&&null==t&&(t=e,e=null),null!=e&&(e="SEASON"+e),this.request({method:"stats/by-summoner/"+n+"/summary",version:"1.2",params:{season:e},extract:"playerStatSummaries"},t)},c.prototype.getRankedStats=function(n,e,t){return"function"==typeof e&&null==t&&(t=e,e=null),null!=e&&(e="SEASON"+e),this.request({method:"stats/by-summoner/"+n+"/ranked",version:"1.2",params:{season:e},extract:"champions"},t)},c.prototype.getSummonerById=function(n,e){return this.request({method:"summoner/"+n,version:"1.2"},e)},c.prototype.getSummonerByName=function(n,e){return this.request({method:"summoner/by-name/"+n,version:"1.2"},e)},c.prototype.getRunes=function(n,e){return this.request({method:"summoner/"+n+"/runes",version:"1.2",extract:"pages"},e)},c.prototype.getMasteries=function(n,e){return this.request({method:"summoner/"+n+"/masteries",version:"1.2",extract:"pages"},e)},c.prototype.getNames=function(){var o,r=n(arguments);r.length>0&&"function"==typeof r[r.length-1]&&(o=r.pop());for(var u,i=40,s=[];r.length;)u=r.splice(0,i).join(","),s.push(this.request({method:"summoner/"+u+"/name",version:"1.2",extract:"summoners"}));var a=t(s).then(function(n){return n.reduce(function(n,e){return n.concat(e)},[])});return o&&e(a,o),a},c.prototype.getTeams=function(n,e){return this.request({method:"team/by-summoner/"+n,version:"2.2"},e)},"object"==typeof module&&null!=module.exports?module.exports=c:"undefined"!=typeof window&&(window.Legends=c)}();