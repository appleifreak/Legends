/*!
 * Legends.js
 * Copyright (c) 2014 Tyler Johnson
 * MIT License
 */
!function(){function e(t,n){return t=Array.prototype.slice.call(t,0),null==n&&(n=[]),t.forEach(function(t){Array.isArray(t)?e(t,n):n.push(t)}),n}function t(e,t){return e.then(function(e){return t(null,e)},function(e){return t(e)})}function n(e){var t=[],n=e.length;return new c(function(o,r){return n?(e.forEach(function(e,u){e=c.lift(e),e.then(function(e){u in t||(t[u]=e,--n||o(t))},r)}),void 0):o(t)})}function o(e,o,r){var u,i,s,a=[];for(e.length>0&&"function"==typeof e[e.length-1]&&(u=e.pop());e.length;)i=e.splice(0,o),a.push(r(i));return s=n(a).then(function(e){return e.reduce(function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},{})}),u&&t(s,u),s}function r(e){return"string"==typeof e?e:"boolean"==typeof e?e?"true":"false":""}function u(e,t,n){return null==e&&(e=void 0),null==t&&(t="&"),null==n&&(n="="),"object"==typeof e?Object.keys(e).map(function(o){var u=encodeURIComponent(r(o))+n,i=e[o];return Array.isArray(i)?i.map(function(e){return u+encodeURIComponent(r(e))}).join(t):u+encodeURIComponent(r(i))}).join(t):""}function i(e,t){if(null==e&&(e=new Error),e.name="HTTPError",null!=t){var n=t.status||t.statusCode;if(!e.message){var o=f[n];null==o&&(o="Server responded with status code "+n),e.message=o}e.status=n,e.response=t,e.toString=function(){return this.name+" "+this.status+": "+this.message}}return e}function s(e){var t=require("http");return new c(function(n,o){t.get(e,function(e){function t(t){o(i(t,e))}if(e.on("error",t),e.statusCode>=400)return t();var r="";e.on("data",function(e){r+=e.toString("utf-8")}),e.on("end",function(){try{n(JSON.parse(r))}catch(e){t(e)}})}).on("error",function(e){o(i(e))})})}function a(e){var t=new XMLHttpRequest;return new c(function(n,o){function r(e){o(i(e,t))}t.onload=function(){if(t.status>=400)return r();try{n(JSON.parse(t.responseText))}catch(e){r(e)}},t.open("get",e),t.send()})}function p(e){return"function"==typeof require?s(e):a(e)}function m(e,t){return this instanceof m?(this.key=e,this.region=t,void 0):new m(e,t)}var c=function(e,t){function n(e,t){return(typeof t)[0]==e}function o(i,s){return s=function a(p,m,c,f,l){function y(e){return function(t){l&&(l=0,a(n,e,t))}}if(f=a.q,p!=n)return o(function(e,t){f.push({p:this,r:e,j:t,1:p,0:m})});if(c&&n(e,c)|n(t,c))try{l=c.then}catch(h){m=0,c=h}if(n(e,l))try{l.call(c,y(1),m=y(0))}catch(h){m(h)}else for(s=r(i,c,m),i=0;i<f.length;)l=f[i++],n(e,p=l[m])?u(l.p,l.r,l.j,c,p):(m?l.r:l.j)(c)},s.q=[],i.call(i={then:function(e,t){return s(e,t)}},function(e){s(n,1,e)},function(e){s(n,0,e)}),i}function r(t,r,i){return function(s,a){return n(e,s=i?s:a)?o(function(e,t){u(this,e,t,r,s)}):t}}function u(o,r,u,i,s){setTimeout(function(){try{i=s(i),s=i&&n(t,i)|n(e,i)&&i.then,n(e,s)?i==o?u(new TypeError):s.call(i,r,u):r(i)}catch(a){u(a)}},0)}return o.resolve=function(e,t){return(t={}).then=r(t,e,1),t},o.reject=function(e,t){return(t={}).then=r(t,e,0),t},o.lift=function(e){return new o(function(t,n){"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"then")?e.then(t,n):e instanceof Error?n(e):t(e)})},o}("f","o"),f={400:"Bad request",401:"Unauthorized",404:"Not found",500:"Internal server error"};m.request=function(e,n){"object"!=typeof e&&(e={});var o=null!=e.method?e.method:"",r=null!=e.region?e.region:"na",i=null!=e.version?e.version:"1.1",s=e.key,a="object"==typeof e.params?e.params:{},m=e.extract,c="http://prod.api.pvp.net/api/lol/";c+=r.toLowerCase()+"/","v"!=i[0]&&(i="v"+i),c+=i+"/",c+=o.split("/").map(function(e){return encodeURIComponent(e)}).reduce(function(e,t){return""!=t&&e.push(t),e},[]).join("/"),null!=s&&(a.api_key=s),c+="?"+u(a);var f=p(c);return null!=m&&(f=f.then(function(e){return e[m]})),"function"==typeof n&&t(f,n),f},m.prototype.request=function(e,t){return"object"!=typeof e&&(e={}),null==e.key&&(e.key=this.key),null==e.region&&(e.region=this.region),m.request(e,t)},m.MATCH_MAKING_QUEUES={2:"Normal 5v5 Blind Pick",4:"Ranked Solo 5v5",7:"Coop vs AI 5v5",8:"Normal 3v3",14:"Normal 5v5 Draft Pick",16:"Dominion 5v5 Blind Pick",17:"Dominion 5v5 Draft Pick",25:"Dominion Coop vs AI",41:"Ranked Team 3v3",42:"Ranked Team 5v5",52:"Twisted Treeline Coop vs AI",65:"ARAM",67:"ARAM Coop vs AI",70:"One for All 5v5",72:"Snowdown Showdown 1v1",73:"Snowdown Showdown 2v2"},m.MAP_NAMES={1:{name:"Summoner's Rift",notes:"Summer Variant"},2:{name:"Summoner's Rift",notes:"Autumn Variant"},3:{name:"The Proving Grounds",notes:"Tutorial Map"},4:{name:"Twisted Treeline",notes:"Original Version"},8:{name:"The Crystal Scar",notes:"Dominion Map"},10:{name:"Twisted Treeline",notes:"Current Version"},12:{name:"Howling Abyss",notes:"ARAM Map"}},m.REGIONS=["NA","EUW","EUNE","BR","TR","LAS"],m.CHALLENGER_TYPES=["RANKED_SOLO_5X5","RANKED_TEAM_3X3","RANKED_TEAM_5X5"],m.prototype.champions=m.prototype.getChampions=function(e,t){return"function"==typeof e&&null==t&&(t=e,e=!1),this.request({method:"champion",version:"1.1",params:{freeToPlay:e?!0:!1},extract:"champions"},t)},m.prototype.recentGames=m.prototype.getRecentGames=function(e,t){return this.request({method:"game/by-summoner/"+e+"/recent",version:"1.3",extract:"games"},t)},m.prototype.challengerLeagues=m.prototype.getChallengerLeagues=function(e,t){return"function"==typeof e&&(t=e,e=0),"number"==typeof e&&(e=m.CHALLENGER_TYPES[e]),this.request({method:"league/challenger",version:"2.3",params:{type:e}},t)},m.prototype.leagueEntries=m.prototype.getLeagueEntries=function(e,t){return this.request({method:"league/by-summoner/"+e+"/entry",version:"2.3"},t)},m.prototype.leagues=m.prototype.getLeagues=function(e,t){return this.request({method:"league/by-summoner/"+e,version:"2.3"},t)},m.prototype.summaryStats=m.prototype.getSummaryStats=function(e,t,n){return"function"==typeof t&&null==n&&(n=t,t=null),null!=t&&(t="SEASON"+t),this.request({method:"stats/by-summoner/"+e+"/summary",version:"1.2",params:{season:t},extract:"playerStatSummaries"},n)},m.prototype.rankedStats=m.prototype.getRankedStats=function(e,t,n){return"function"==typeof t&&null==n&&(n=t,t=null),null!=t&&(t="SEASON"+t),this.request({method:"stats/by-summoner/"+e+"/ranked",version:"1.2",params:{season:t},extract:"champions"},n)},m.prototype.summonerById=m.prototype.summonersById=m.prototype.getSummonerById=m.prototype.getSummonersById=function(){var t=e(arguments),n=this;return o(t,40,function(e){return n.request({method:"summoner/"+e.join(","),version:"1.3"})})},m.prototype.summonerByName=m.prototype.summonersByName=m.prototype.getSummonerByName=m.prototype.getSummonersByName=function(){var t=e(arguments),n=this;return o(t,40,function(e){return n.request({method:"summoner/by-name/"+e.join(","),version:"1.3"})})},m.prototype.runes=m.prototype.getRunes=function(){var t=e(arguments),n=this;return o(t,40,function(e){return n.request({method:"summoner/"+e.join(",")+"/runes",version:"1.3"})})},m.prototype.masteries=m.prototype.getMasteries=function(){var t=e(arguments),n=this;return o(t,40,function(e){return n.request({method:"summoner/"+e.join(",")+"/masteries",version:"1.3"})})},m.prototype.names=m.prototype.summonerNames=m.prototype.getNames=m.prototype.getSummonerNames=function(){var t=e(arguments),n=this;return o(t,40,function(e){return n.request({method:"summoner/"+e.join(",")+"/name",version:"1.3"})})},m.prototype.teams=m.prototype.getTeams=function(e,t){return this.request({method:"team/by-summoner/"+e,version:"2.2"},t)},"object"==typeof module&&null!=module.exports?module.exports=m:"undefined"!=typeof window&&(window.Legends=m)}();